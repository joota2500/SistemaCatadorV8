<!DOCTYPE html>
<html lang="pt-br">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>{% block title %}Sistema Catador V8{% endblock %}</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Ícones -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

    <style>
        body {
            background: #f3f6f4;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-size: cover !important;
            background-position: center !important;
            background-repeat: no-repeat !important;
        }

        /* QUANDO ESTIVER NA TELA DE LOGIN → APLICA O FUNDO */
        body.login-background {
            background-image: url("{% static 'img/bg_login.jpg' %}") !important;
        }

        /* SIDEBAR */
        .sidebar {
            width: 260px;
            background: linear-gradient(180deg, #145c3a, #0f3c27);
            min-height: 100vh;
            color: #ffffff;
            position: fixed;
            left: 0;
            top: 0;
            display: flex;
            flex-direction: column;
            padding: 12px 0;
        }

        .sidebar-header {
            text-align: center;
            padding: 12px 15px 18px 15px;
            border-bottom: 1px solid rgba(255,255,255,0.10);
        }

        .sidebar-logo-circle {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            border: 2px solid #38c776;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 8px auto;
            background: rgba(0,0,0,0.15);
        }

        .sidebar-logo-circle i {
            font-size: 26px;
            color: #38c776;
        }

        .sidebar-title-main {
            font-size: 16px;
            font-weight: 700;
            color: #e8f5e9;
        }

        .sidebar-title-sub {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #b8e8c9;
        }

        .sidebar-menu {
            flex: 1;
            padding: 10px 14px;
        }

        .sidebar-link {
            display: flex;
            align-items: center;
            padding: 10px 12px;
            font-size: 15px;
            color: #e9f7ed;
            text-decoration: none;
            border-radius: 8px;
            margin-bottom: 4px;
            transition: 0.15s;
            cursor: pointer;
        }

        .sidebar-link:hover {
            background: #1f7f50;
        }

        .submenu {
            background: rgba(255,255,255,0.04);
            border-radius: 8px;
            margin-left: 8px;
            margin-top: 4px;
            display: none;
            padding-left: 10px;
        }

        .submenu-open { display:block !important; }

        .arrow { margin-left:auto; transition:0.2s; }
        .arrow.open { transform:rotate(90deg); }

        .content { padding:20px; }
        .content-auth { margin-left:260px; }

    </style>
</head>

<body class="{% if not request.user.is_authenticated %}login-background{% endif %}">

{% if request.user.is_authenticated %}
<nav class="sidebar">

    <div class="sidebar-header">
        <div class="sidebar-logo-circle">
            <i class="fa-solid fa-recycle"></i>
        </div>
        <div class="sidebar-title-main">Sistema Catador V8</div>
        <div class="sidebar-title-sub">Gestão Ambiental</div>
    </div>

    <div class="sidebar-menu">

        {% if request.user.role == "programador" %}
            <a href="{% url 'painel_programador' %}" class="sidebar-link">
                <i class="fa-solid fa-gauge"></i> Painel Principal
            </a>

            <div class="sidebar-link" onclick="toggleSubmenu('submenuProg','arrowProg')">
                <i class="fa-solid fa-user-gear"></i> Programadores
                <i id="arrowProg" class="fa-solid fa-chevron-right arrow"></i>
            </div>

            <div id="submenuProg" class="submenu">
                <a href="{% url 'lista_programadores' %}"><i class="fa-solid fa-list"></i> Lista</a>

                {% if prog_count < 2 %}
                <a href="{% url 'adicionar_programador' %}"><i class="fa-solid fa-user-plus"></i> Novo</a>
                {% else %}
                <a style="opacity:.5;pointer-events:none;"><i class="fa-solid fa-user-lock"></i> Limite</a>
                {% endif %}
            </div>

            <a href="{% url 'add_municipio' %}" class="sidebar-link">
                <i class="fa-solid fa-city"></i> Novo Município
            </a>

            <a href="{% url 'add_encarregado' %}" class="sidebar-link">
                <i class="fa-solid fa-user-plus"></i> Novo Encarregado
            </a>

            <a href="{% url 'relatorio_logins' %}" class="sidebar-link">
                <i class="fa-solid fa-shield-halved"></i> Acessos
            </a>

        {% else %}
            <a href="{% url 'painel_municipio' %}" class="sidebar-link">
                <i class="fa-solid fa-table-columns"></i> Painel Municipal
            </a>
        {% endif %}
    </div>

    <div class="sidebar-footer px-3">
        <a href="{% url 'logout' %}" class="sidebar-link">
            <i class="fa-solid fa-right-from-bracket"></i> Sair
        </a>
    </div>

</nav>
{% endif %}

<div class="content {% if request.user.is_authenticated %}content-auth{% endif %}">
    {% block content %}{% endblock %}
</div>

<script>
function toggleSubmenu(id, arrowId) {
    document.getElementById(id).classList.toggle("submenu-open");
    document.getElementById(arrowId).classList.toggle("open");
}
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>